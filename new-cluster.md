# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®æ§‹ç¯‰ãƒ»å‰Šé™¤

ä»Šå¾Œã®æˆæ¥­é–‹å§‹æ™‚ã«ã¯ã€minikubeã«ã‚ˆã‚‹K8sã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒå¿…é ˆã¨ãªã‚Šã¾ã™ã€‚
ã“ã“ã§ã¯ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆã¨å‰Šé™¤ã«ã¤ã„ã¦ã¾ã¨ã‚ã¦ãŠãã¾ã™ã€‚

## ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®ä½œæˆ

minikubeãŒå…¥ã£ãŸã‚‰ã€ **ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼(cluster)** ã‚’ä½œã‚Šã¾ã™ã€‚
ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯ã€ã€ŒK8sã‚’èµ°ã‚‰ã›ã‚‹ **ãƒãƒ¼ãƒ‰(node)** ã®é›†åˆ+Î±ã€ ã¨è€ƒãˆã¦ãã ã•ã„ã€‚
ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«ã¯ã€å®Ÿéš›ã«ä½œæ¥­ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãªã©ã‚’èµ°ã‚‰ã›ã‚‹ãŸã‚ã®ãƒ¯ãƒ¼ã‚«ãƒ¼ã¨ã€ãã‚Œã‚’åˆ¶å¾¡ã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒå¿…è¦ã§ã™ãŒã€
minikubeã¯ã“ã‚Œã‚‰ã®åŸºæœ¬ç’°å¢ƒã‚’æ‰‹æŒã¡ã®ãƒªã‚½ãƒ¼ã‚¹ã®ä¸­ã‹ã‚‰é©å½“ã«é¸ã‚“ã§æœ€å°é™ã®ç’°å¢ƒã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

æ‰‹é †ã¯ã¨ã¦ã‚‚ç°¡å˜ã§ã€

```powershell
PS> minikube start
```

ã¨ã™ã‚‹ã ã‘ã§ã™ã€‚ã“ã‚Œã§ç’°å¢ƒã‚’è‡ªå‹•æ¤œå‡ºã—ã¦æ§‹ç¯‰ã‚’é–‹å§‹ã—ã¾ã™ã€‚
ä»¥ä¸‹ã®å®Ÿè¡Œä¾‹ã¯ã€macOSã§ã®å®Ÿè¡Œä¾‹ã¨ãªã‚Šã¾ã™ã€‚åˆã‚ã¦å®Ÿè¡Œã™ã‚‹ã¨ããªã©ã¯ã€å¿…è¦ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®ãŸã‚æ™‚é–“ãŒå°‘ã—ã‹ã‹ã‚Šã¾ã™ã€‚
ãªã®ã§ã€å…ˆã«ç’°å¢ƒæ§‹ç¯‰ã‹ã‚‰å§‹ã‚ã¦ã„ã‚‹æ¬¡ç¬¬ã§ã™ã€‚

```zsh
% minikube start
ğŸ˜„  Darwin 12.5 ä¸Šã® minikube v1.26.1
âœ¨  docker ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒè‡ªå‹•çš„ã«é¸æŠã•ã‚Œã¾ã—ãŸã€‚ä»–ã®é¸æŠè‚¢: hyperkit, virtualbox, ssh
ğŸ“Œ  root æ¨©é™ã‚’æŒã¤ Docker Desktop ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨
ğŸ‘  minikube ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸­ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã® minikube ãƒãƒ¼ãƒ‰ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™
ğŸšœ  ãƒ™ãƒ¼ã‚¹ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’å–å¾—ã—ã¦ã„ã¾ã™...
ğŸ”¥  docker container (CPUs=2, Memory=3886MB) ã‚’ä½œæˆã—ã¦ã„ã¾ã™...
ğŸ³  Docker 20.10.17 ã§ Kubernetes v1.24.3 ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...
    â–ª è¨¼æ˜æ›¸ã¨éµã‚’ä½œæˆã—ã¦ã„ã¾ã™...
    â–ª ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...
    â–ª RBAC ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šä¸­ã§ã™...
ğŸ”  Kubernetes ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™...
    â–ª gcr.io/k8s-minikube/storage-provisioner:v5 ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
ğŸŒŸ  æœ‰åŠ¹ãªã‚¢ãƒ‰ã‚ªãƒ³: default-storageclass
ğŸ„  çµ‚äº†ã—ã¾ã—ãŸï¼kubectl ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€Œminikubeã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã€Œdefaultã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã•ã‚Œã¾ã—ãŸ
```

```zsh
% minikube status # ç¨¼åƒçŠ¶æ³ã®ç¢ºèª
minikube
type: Control Plane
host: Running
kubelet: Running
apiserver: Running
kubeconfig: Configured
```

å‹•ã„ã¦ã„ãªã„ã¨ãã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚

```zsh
# minikubeç’°å¢ƒã‚’æ§‹ç¯‰ã—ãŸã‘ã©åœæ­¢ã—ã¦ã„ã‚‹ã¨ã
% minikube status
minikube
type: Control Plane
host: Stopped      # åœæ­¢çŠ¶æ…‹
kubelet: Stopped
apiserver: Stopped
kubeconfig: Stopped
```

```zsh
# æ§‹ç¯‰ã™ã‚‰ã—ã¦ã„ãªã„å ´åˆ
% minikube status
ğŸ¤·  ã€Œminikubeã€ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚å…¨ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã«ã€Œminikube profile listã€ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚
ğŸ‘‰  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã«ã¯ã€ã€Œminikube startã€ã‚’å®Ÿè¡Œã—ã¾ã™
```

### ãŠã¾ã‘: ãƒãƒ¼ãƒ‰ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚º

èµ·å‹•ã™ã‚‹ãƒãƒ¼ãƒ‰ã«ã¤ã„ã¦ã¯ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ã§ã™ã€‚
CPUã¨ãƒ¡ãƒ¢ãƒªã¯ãã‚Œãã‚Œåˆå›start(ã‚¯ãƒ©ã‚¹ã‚¿ä½œæˆ)ã®éš›ã« `--memory` ã¨ `--cpus` ã§æ¸¡ã›ã¾ã™ã€‚
ãŸã ã—ã€åˆ©ç”¨ã™ã‚‹ãƒ‰ãƒ©ã‚¤ãƒã¨å®Ÿè¡Œç’°å¢ƒã«ã‚ˆã‚Šèƒ½åŠ›ã‚’é£›ã³è¶Šãˆã‚‹è¨­å®šã¯å¤±æ•—ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```zsh
# 8192MB(8G), 4cpus
% minikube start --memory=8g --cpus=4 â€»å¤±æ•—
ğŸ˜„  Darwin 12.5 ä¸Šã® minikube v1.26.1
âœ¨  docker ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒè‡ªå‹•çš„ã«é¸æŠã•ã‚Œã¾ã—ãŸã€‚ä»–ã®é¸æŠè‚¢: hyperkit, virtualbox, ssh
- docker ãƒ‡ãƒ¼ãƒ¢ãƒ³ãŒååˆ†ãª CPU/ãƒ¡ãƒ¢ãƒªãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã‚’åˆ©ç”¨ã§ãã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚
- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ https://docs.docker.com/docker-for-mac/#resources
```

Docker Desktopã®è¨­å®šã§CPUã¨ãƒ¡ãƒ¢ãƒªã®ä¸Šé™ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãã‚Œã‚’è¶…ãˆãŸè¨­å®šãŒã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚ŒãŸçŠ¶æ…‹ã§ã™ã€‚
ã¨ã„ã†ã“ã¨ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ã€DockerãŒå…¥ã£ã¦ã„ã‚‹å ´åˆã¯ãã‚Œã‚’ç”¨ã„ã‚‹ãŸã‚ã€Dockerã®å‹•ä½œç’°å¢ƒã«ä¾å­˜ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

ãã®ä»–ã®å®Ÿè¡Œç’°å¢ƒã‚’é¸ã¹ã°ä½™åœ°ã¯ã‚ã‚Šã¾ã™ã€‚ä¾‹ãˆã°VirtualBoxãŒå…¥ã£ã¦ã„ã‚Œã°ã€ãã‚Œã‚’ç”¨ã„ã¦æ§‹ç¯‰ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚

```zsh
# 8192MB(8G), 4cpus on VirtualBox
minikube start --memory=8g --cpus=4 --driver=virtualbox
ğŸ˜„  Darwin 12.5 ä¸Šã® minikube v1.26.1
âœ¨  ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è¨­å®šã«åŸºã¥ã„ã¦ virtualbox ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã‚’ä½¿ç”¨ã—ã¾ã™
ğŸ‘  minikube ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸­ã®ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã® minikube ãƒãƒ¼ãƒ‰ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™
ğŸ”¥  virtualbox VM (CPUs=4, Memory=8192MB, Disk=20000MB) ã‚’ä½œæˆã—ã¦ã„ã¾ã™...
ğŸ³  Docker 20.10.17 ã§ Kubernetes v1.24.3 ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...
    â–ª è¨¼æ˜æ›¸ã¨éµã‚’ä½œæˆã—ã¦ã„ã¾ã™...
    â–ª ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ¼ãƒ³ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™...
    â–ª RBAC ã®ãƒ«ãƒ¼ãƒ«ã‚’è¨­å®šä¸­ã§ã™...
    â–ª gcr.io/k8s-minikube/storage-provisioner:v5 ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™
â•­â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•®
â”‚                                                                                                                      â”‚
â”‚    ã€Œvirtualboxã€ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ãŒé¸æŠã•ã‚Œã¾ã—ãŸãŒã€ã‚ˆã‚Šè‰¯ã„é¸æŠè‚¢ãŒã‚ã‚Šã¾ã™ï¼                                            â”‚
â”‚    æ€§èƒ½ã¨æ©Ÿèƒ½ã®å‘ä¸Šã®ãŸã‚ã€åˆ¥ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ä½¿ç”¨ã‚’æ¤œè¨ã—ã¦ãã ã•ã„:                                                     â”‚
â”‚            - hyperkit                                                                                                â”‚
â”‚                                                                                                                      â”‚
â”‚    ã“ã®è­¦å‘Šã‚’è¡¨ç¤ºã•ã›ãªã„ãŸã‚ã«ã¯ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„:                                                           â”‚
â”‚                                                                                                                      â”‚
â”‚            $ minikube config set WantVirtualBoxDriverWarning false                                                   â”‚
â”‚                                                                                                                      â”‚
â”‚                                                                                                                      â”‚
â”‚    minikube ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«ã¤ã„ã¦ã‚‚ã£ã¨çŸ¥ã‚‹ãŸã‚ã«ã¯ã€https://minikube.sigs.k8s.io/docs/drivers/ ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚    â”‚
â”‚    ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã«ã¤ã„ã¦ã¯ https://minikube.sigs.k8s.io/docs/benchmarks/cpuusage/ ã‚’ç¢ºèªã—ã¦ãã ã•ã„                  â”‚
â”‚                                                                                                                      â”‚
â•°â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¯
ğŸ”  Kubernetes ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™...
ğŸŒŸ  æœ‰åŠ¹ãªã‚¢ãƒ‰ã‚ªãƒ³: default-storageclass, storage-provisioner
ğŸ„  çµ‚äº†ã—ã¾ã—ãŸï¼kubectl ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã€Œminikubeã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¨ã€Œdefaultã€ãƒãƒ¼ãƒ ã‚¹ãƒšãƒ¼ã‚¹ã‚’ä½¿ç”¨ã™ã‚‹ã‚ˆã†è¨­å®šã•ã‚Œã¾ã—ãŸ
```

VirtualBoxã®ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’ä½¿ã†ã¨å®Ÿéš›ã«VMãŒå‹•ã„ã¦ã„ã‚‹ã“ã¨ã‚‚ç¢ºèªã§ãã¾ã™ã€‚

![ViatualBoxãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã®ç¢ºèªä¾‹](images/minikube-virtualbox.png)

é€”ä¸­ã§æŒ‡æ‘˜ã•ã‚Œã¦ã„ã‚‹ã‚ˆã†ã«ã€ã‚ˆã‚Šã‚ˆã„ç’°å¢ƒã¨ã—ã¦ã¯ã€Hyper-V(Windows10/11 pro)ã‚„hyperkit(macOS)ã®åˆ©ç”¨ãŒæ¨å¥¨ã•ã‚Œã¦ã„ã¾ã™ã€‚
Dockerä»¥å¤–ã§è¡Œã†ã¨ãã¯ã€åˆ©ç”¨å¯èƒ½ã§ã‚ã‚Œã°ä½¿ã£ã¦ã¿ã‚‹ã“ã¨ã‚‚æ¤œè¨ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

ãªãŠã€æˆæ¥­å†…ã§è¡Œã†å†…å®¹ã§ã‚ã‚Œã°ã€ **åŸºæœ¬çš„ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®ãƒªã‚½ãƒ¼ã‚¹(CPUã€ãƒ¡ãƒ¢ãƒª)ã§ååˆ†ã§ã™** ã€‚

## ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã®å‰Šé™¤

ä¸è¦ã«ãªã£ãŸã‚Šã€å®Œå…¨ã«ã‚„ã‚Šç›´ã—ãŸã„å ´åˆã‚‚ã€ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã¯ã•ãã£ã¨æ¶ˆã›ã¾ã™ã€‚

```powershell
# ã‚¯ãƒ©ã‚¹ã‚¿èµ·å‹•ä¸­ã§ã‚‚OK
PS> minikube delete
ğŸ”¥  virtualbox ã®ã€Œminikubeã€ã‚’å‰Šé™¤ã—ã¦ã„ã¾ã™...
ğŸ’€  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã€Œminikubeã€ã®å…¨ã¦ã®ãƒˆãƒ¬ãƒ¼ã‚¹ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚
```
