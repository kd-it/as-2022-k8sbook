# ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒãƒ¼ãƒ‰

ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã«é–¢ã‚ã‚‹è¦ç´ ã¨ã—ã¦ã€replicasetãƒªã‚½ãƒ¼ã‚¹ã¨ã„ã†ã‚‚ã®ãŒã‚ã‚Šã¾ã—ãŸã€‚
deploymentã®é…ä¸‹ã¨ã—ã¦å‹•ãã€å®Ÿéš›ã«Podã®æ•°ã‚’èª¿æ•´ã—ã¦ã„ãç«‹å ´ã«ã‚ã‚‹ã‚‚ã®ã§ã—ãŸã€‚
ã§ã¯replicasetã¯ã©ã®ç¨‹åº¦ã¾ã§Podã‚’å¢—ã‚„ã—ã¦ã„ã‘ã‚‹ã®ã§ã—ã‚‡ã†ã‹â€¦

## ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ã®ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°

ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«æ›¸ãã“ã¨ã§ã€é©ç”¨ã™ã‚Œã°ãã®å€¤ã«ãªã‚‹ã‚ˆã†ã«ã¨ã¯ãŸã‚‰ãã¾ã™ãŒã€ä¸€æ™‚çš„ã«å¤‰æ›´ã—ãŸã„ã¨ã„ã†ãƒ¬ãƒ™ãƒ«ã§ã‚ã‚Œã°ã€ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ä¸Šã§ã‚‚ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®è¨­å®šã¯å¯èƒ½ã§ã™ã€‚

```{code-block} ps1
:caption: ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å‘¼ã³å‡ºã—ä¾‹
# åˆæœŸçŠ¶æ…‹ã§ãƒ‡ãƒ—ãƒ­ã‚¤(ãƒ‡ãƒ—ãƒ­ã‚¤æ¸ˆã®æ–¹ã¯ãã®ã¾ã¾ä½¿ã£ã¦çµæ§‹ã§ã™)
PS> kubectl apply -f deploy1.yml
# ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å‘¼ã³å‡ºã—
PS> kubectl scale deploy/frontend --replicas=4
```

`kubectl scale`ã‚³ãƒãƒ³ãƒ‰ã«ã‚ˆã‚Šã€æŒ‡å®šã—ãŸãƒªã‚½ãƒ¼ã‚¹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«å¯¾ã—ã€è¤‡è£½æ•°ã‚’è¨­å®šã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã«ãŠã‘ã‚‹ `spec.replicas` ã‚’ç›´æ¥æŒ‡å®šã™ã‚‹ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚
ã“ã®å ´åˆã€ä½œæˆã—ãŸã„è¤‡è£½ã‚’4ã‚’ç›®æ¨™ã¨ã•ã›ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚
ãªãŠã“ã®å€¤ã¯ä¾¿å®œä¸Š **ãƒ¬ãƒ—ãƒªã‚«æ•°** ã¨è¡¨ç¾ã—ã¦ãŠãã¾ã™ã€‚

ã†ã¾ãã§ããŸã‹ã¯ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ…‹ã¨ãƒãƒƒãƒ‰çŠ¶æ…‹ã§ç¢ºèªã§ãã¾ã™ã€‚

```{code-block} ps1
:caption: ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®çŠ¶æ³ã‚’ç¢ºèª(ãƒ¬ãƒ—ãƒªã‚«æ•°4ã§è¨­å®š)
PS> kubectl get deploy # ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   4/4     4            4           22h
PS> kubectl get pods # ãƒãƒƒãƒ‰
NAME                        READY   STATUS    RESTARTS   AGE
frontend-675c86d757-fhwlg   1/1     Running   0          10m
frontend-675c86d757-thlcn   1/1     Running   0          21s
frontend-675c86d757-vjjgb   1/1     Running   0          12m
frontend-675c86d757-wjpnz   1/1     Running   0          21s
```

```{caution}
ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ã®æŒ‡ç¤ºã‚’å‡ºã—ãŸã‚ã¨ã€é †æ¬¡ä¸è¶³ã—ã¦ã„ã‚‹ãƒãƒƒãƒ‰ã®èµ·å‹•ã‚’è¡Œã†ãŸã‚ã€ã™ãåæ˜ ã•ã‚Œã¾ã›ã‚“ã€‚
ã¡ã¾ã¡ã¾ã¨ä¸ŠãŒã£ã¦ã„ãã‚ˆã†ãªæ„Ÿã˜ãªã®ã§ã€æ„è­˜ã—ã¦å°‘ã—é–“ã‚’ç½®ã„ã¦ã‹ã‚‰ç¢ºèªã™ã‚‹ã‹ã€ã¡ã‚‡ã“ã¡ã‚‡ã“èµ·å‹•ã—ã¦çœºã‚ã¦ãã ã•ã„ã€‚
```

````{tip}
**ã‚¹ã‚±ãƒ¼ãƒ«ã‚’0ã«ã™ã‚‹**ã“ã¨ã‚‚å¯èƒ½ã§ã™ã€‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã¯å­˜åœ¨ã—ã¾ã™ãŒã€èµ·å‹•ã™ã‚‹ãƒãƒƒãƒ‰ã®æ•°ãŒæŒ‡ç¤ºé€šã‚Š0ã«ãªã‚Šã¾ã™ã€‚
ã‚ã¨ã§ã¾ãŸä½¿ã†ãŸã‚ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆã‚’æ®‹ã—ã¦ãŠããŸã„ã¨ãã«ä½¿ã†ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚

```{code-block} ps1
:caption: ãƒ¬ãƒ—ãƒªã‚«æ•°0ã®å ´åˆ
PS> kubectl scale deploy/frontend --replicas 0
deployment.apps/frontend scaled
PS> kubectl get deploy
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   0/0     0            0           22h
```
````

## ã©ã“ã¾ã§å¢—ã‚„ã›ã‚‹?

```{warning}
ã“ã®éƒ¨åˆ†ã¯ç’°å¢ƒä¾å­˜ã®éƒ¨åˆ†ãŒå¼·ã„ã®ã§ã€æ€¥ã„ã§ã‚„ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã¨ã¯ã„ãˆãƒ­ãƒ¼ãƒ‰ãƒãƒ©ãƒ³ã‚µãƒ¼ãªã©ã‚’æ„è­˜ã™ã‚‹ã¨ãã«ã¯èµ·å‹•æ•°ãŒç·å®šæ•°ã¨ä¸€è‡´ã—ãªã„ã“ã¨ãŒã‚ã‚‹ã®ã§ãã®æ™‚ã«æ”¹ã‚ã¦è©¦ã—ã¦ã¿ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚
```


`--replica` ã«æ¸¡ã™ãƒ¬ãƒ—ãƒªã‚«æ•°ã¯ã€ã„ãã¤ã¾ã§ã§ãã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€‚
è©¦ã—ã«ãƒ¬ãƒ—ãƒªã‚«æ•°ã‚’æ›¸ãæ›ãˆã¦è©¦ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

ã“ã“ã§ã¯8ã«ã—ã¦ã¿ã¾ã™ã€‚

```{code-block} ps1
:caption: ãƒ¬ãƒ—ãƒªã‚«æ•°8ã®å ´åˆ
PS> kubectl scale deploy/frontend --replicas 8
deployment.apps/frontend scaled
PS> kubectl get deploy
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   4/8     8            4           22h
# å°‘ã—æ™‚é–“ã‚’ãŠã„ã¦ã‹ã‚‰å†åº¦ç¢ºèª
kubectl get deploy
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   6/8     8            6           22h
```

å¢—ãˆã¾ã›ã‚“ã­â€¦ ãƒãƒƒãƒ‰å´ã‚‚ç¢ºèªã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚

```{code-block} ps1
:emphasize-lines: 5,11

# ãƒãƒƒãƒ‰çŠ¶æ…‹ã®ç¢ºèª
kubectl get pods
NAME                        READY   STATUS    RESTARTS   AGE
frontend-675c86d757-2dz7s   1/1     Running   0          2m20s
frontend-675c86d757-5m6fn   0/1     Pending   0          2m20s
frontend-675c86d757-mxsbj   1/1     Running   0          2m20s
frontend-675c86d757-p52nv   1/1     Running   0          2m20s
frontend-675c86d757-p565l   1/1     Running   0          2m20s
frontend-675c86d757-p9ff6   1/1     Running   0          2m20s
frontend-675c86d757-sl2g5   1/1     Running   0          2m20s
frontend-675c86d757-xkn9z   0/1     Pending   0          2m20s
```

è¦‹ã¦ã®é€šã‚Šã€ **Pending**ã¨ã„ã†çŠ¶æ…‹ã®ã‚‚ã®ãŒå‡ºã¦ã„ã¾ã™ã€‚èµ·å‹•ã‚’ä¿ç•™ã—ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚

K8sã®ãƒãƒ¼ãƒ‰(å®Ÿéš›ã«ãƒãƒƒãƒ‰ãŒå‹•ãã“ã¨ã«ãªã‚‹ãƒ›ã‚¹ãƒˆ)ã¯ã€ãã‚Œãã‚Œã®æŒã¤æ€§èƒ½ã¨ã„ã†ã‚‚ã®ã‚’ã‚ã‚‹ç¨‹åº¦æŠŠæ¡ã—ã¦ã„ã¾ã™ã€‚
å®Ÿã¯ä»Šå›ã®ãƒãƒƒãƒ‰é”ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸Šã§ä»¥ä¸‹ã®è¨­å®šãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

```{literalinclude} codes/deploy1.yml
:linenos:
:lines: 9-22
:emphasize-lines: 9-12
```

* CPUã®åˆ©ç”¨ã¯ä¸Šé™500m(500ãƒŸãƒªç§’)ä½¿ã„ãŸã„
* ãƒ¡ãƒ¢ãƒªåˆ©ç”¨ã¯ä¸Šé™128MB(128ãƒ¡ã‚¬ãƒã‚¤ãƒˆ)ä½¿ã„ãŸã„

CPUã®åˆ©ç”¨ç‡ã¯CPU1å€‹åˆ†ã‚’ã€Œ1ç§’å½“ãŸã‚Šã“ã‚Œã ã‘å¿…è¦ã§ã‚ã‚‹ã€ã¨ã„ã†æ„å‘³åˆã„ã§ä½¿ã„ã¾ã™ã€ãã®ãŸã‚500m(ãƒŸãƒªç§’)ã¨ã—ãŸå ´åˆã€CPU1å€‹ã®åŠåˆ†ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚ä»Šå›ã®ãƒãƒ¼ãƒ‰ç”¨ã«ã¯4CPUã§æ§‹æˆã—ã¦ã„ã‚‹ãŸã‚ã€8ã¤ã®ãƒãƒƒãƒ‰ãŒå‹•ã‹ã›ã‚‹ã‚ˆã†ã«æ€ãˆã¾ã™ãŒã€
å®Ÿéš›ã«ã¯6ã¤ã®ãƒãƒƒãƒ‰(500ãƒŸãƒªç§’Ã—6ãƒãƒƒãƒ‰=3000ãƒŸãƒªç§’=CPU3å€‹åˆ†)ãŒä¸Šé™ã¨ãªã£ã¦ã„ã¾ã™ã€‚
ã“ã‚Œã¯K8sã®ç®¡ç†ãƒ—ãƒ­ã‚»ã‚¹(ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¹ã‚¿ãƒ¼)ãŒä¸€ç·’ã«å‹•ã„ã¦ã„ã‚‹ã“ã¨ãŒåŸå› (ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒCPUã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚‰)ã§ã™ã€‚

è©¦ã—ã«CPU2ã¤ã«è½ã¨ã—ãŸç’°å¢ƒã§åŒã˜ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’èµ°ã‚‰ã›ã¦ã¿ã¾ã™ã€‚
Dockerãƒ™ãƒ¼ã‚¹ã§minikubeã‚’ã—ãŸå ´åˆã€Docker Desktopã§åˆ©ç”¨ã—ã¦ã„ã‚‹CPUæ•°åˆ†å®Ÿã¯ä½¿ã†ãŸã‚ã€minikubeã§ä½œã‚‹ãƒãƒ¼ãƒ‰ã®CPUæ•°ã¨å®Ÿéš›ã«è¦‹ãˆã¦ã„ã‚‹CPUæ•°ãŒç•°ãªã‚‹ã¨ã„ã†ã‚„ã‚„ã“ã—ã„çŠ¶æ…‹ã«ãªã‚Šã¾ã™ã€‚

ã“ã“ã§ã¯macOSã®ãŸã‚ã€hyperkitãƒ‰ãƒ©ã‚¤ãƒã«ã‚ˆã‚‹VMã‚’ä½¿ã£ã¦æ¤œè¨¼ã—ã¦ã¿ã¾ã™ã€‚
Windowsã®å ´åˆã¯Hyper-V(hyperv)ã‹VirtualBox(virtualbox)ã§è¡Œã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

```{code-block} ps1
:caption: minikubeã«ã‚ˆã‚‹ã‚¯ãƒ©ã‚¹ã‚¿ã®å†ç”Ÿæˆâ†’å†åº¦ãƒ¬ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
PS> minikube delete # ã‚¯ãƒ©ã‚¹ã‚¿ã®å‰Šé™¤
PS> minikube start --driver=hyperkit --cpus=2
PS> kubectl apply -f deploy1.yml
PS> kubectl scale deploy/frontend --replicas 8
PS> kubectl get deploy # 30ç§’ãã‚‰ã„ãŠã„ãŸã»ã†ãŒã„ã„
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   2/8     8            2           41s
```

ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¹ã‚¿ãƒ¼ãŒCPU1ã¤ã‚’å¥ªã£ã¦ã„ã‚‹ã‹ã‚‰ã‹ã€ä½¿ãˆã‚‹ã®ã¯2ã¤ã«ãªã£ã¦ã„ã‚‹ã‚ˆã†ã§ã™ã€‚

```{code-block} ps1
PS> kubectl get podskubectl get pods
NAME                        READY   STATUS    RESTARTS   AGE
frontend-675c86d757-4cwsc   0/1     Pending   0          38s
frontend-675c86d757-9rsf7   0/1     Pending   0          38s
frontend-675c86d757-d6t9j   1/1     Running   0          38s
frontend-675c86d757-dcfxc   0/1     Pending   0          38s
frontend-675c86d757-kfx9j   0/1     Pending   0          38s
frontend-675c86d757-rr8z6   1/1     Running   0          75s
frontend-675c86d757-sr72m   0/1     Pending   0          38s
frontend-675c86d757-x4dvq   0/1     Pending   0          38s
```

ã¨ã€ã‚„ã¯ã‚ŠPendingã ã‚‰ã‘ã§ã™ã€‚

ã“ã®ã¾ã¾ã§ã¯å¿…è¦æ•°ã ã‘å‹•ã‹ã›ã¾ã›ã‚“ã€‚ã©ã†ã™ã‚Œã°è‰¯ã„ã®ã§ã—ã‚‡ã†ã€‚

- CPUã®è¦æ±‚é‡ã‚’ã‚‚ã£ã¨å°ã•ãã™ã‚‹(ä¾‹ãˆã°100mã¨ã‹)
- CPUã‚’å¢—ã‚„ã™

ãªã©ãŒæƒ³åƒã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚

## CPUåˆ©ç”¨ã‚’æ¸›ã‚‰ã™

ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹CPUåˆ©ç”¨ç‡ã‚’èª¿æ•´ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ä¾‹ãˆã°100ãƒŸãƒªç§’ã«ã—ã¦ã¿ã¾ã™ã€‚

```{literalinclude} codes/deploy1-limitCPU.yml
:language: yaml
:lines: 17-20
:emphasize-lines: 4

CPUä¸Šé™ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’100ãƒŸãƒªç§’ã«ã—ãŸå ´åˆ
```

ã“ã¡ã‚‰ã‚’é©ç”¨ã•ã›ã¦ã¿ã¾ã™ã€‚

``{code-block} PS1
PS> kubectl delete -f deploy1.yml # ä¸€åº¦å‰Šé™¤ â€»é‡è¦!
PS> kubectl apply -f deploy1.yml # å†é©ç”¨
PS> kubectl scale deploy/frontend --replicas 8
# ã—ã°ã‚‰ãå¾…ã¤
PS> kubectl get pods
NAME                        READY   STATUS    RESTARTS   AGE
frontend-699474d56f-28fj6   1/1     Running   0          3m19s
frontend-699474d56f-ds49s   1/1     Running   0          3m44s
frontend-699474d56f-grq2x   1/1     Running   0          3m19s
frontend-699474d56f-hhvq8   1/1     Running   0          3m19s
frontend-699474d56f-l5lxh   1/1     Running   0          3m19s
frontend-699474d56f-ndvm2   1/1     Running   0          3m19s
frontend-699474d56f-s5zrr   1/1     Running   0          3m19s
frontend-699474d56f-tq4xn   1/1     Running   0          3m19s
```

åˆè¨ˆ800ãƒŸãƒªç§’ã¨ãªã‚‹ãŸã‚ã€CPU1ã¤åˆ†ã«åã¾ã‚‹ã®ã§å¤§ä¸ˆå¤«ã ã£ãŸã‚ˆã†ã§ã™ã­ã€‚

ä¸€åº¦ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®å‰Šé™¤(`kubektl delete -f ...`)ã‚’ã—ã¦ãŠã„ã¦ã€ãã®å¾Œ500mã«CPUã‚’æˆ»ã—ãŸçŠ¶æ…‹ã§é©ç”¨ã—ã¦å…ƒã«æˆ»ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

## ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã™

ãƒ¬ãƒ—ãƒªã‚«æ•°8ã«ã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

``{code-block} PS1
PS> kubectl get pods
NAME                        READY   STATUS    RESTARTS   AGE
frontend-675c86d757-6ztxg   1/1     Running   0          4s
frontend-675c86d757-fxwlf   1/1     Running   0          11s
frontend-675c86d757-gzh4c   0/1     Pending   0          4s
frontend-675c86d757-mt57f   0/1     Pending   0          4s
frontend-675c86d757-qfjn8   0/1     Pending   0          4s
frontend-675c86d757-t2x8g   0/1     Pending   0          4s
frontend-675c86d757-wlgq9   0/1     Pending   0          4s
frontend-675c86d757-xvgt6   0/1     Pending   0          4s
``

K8sã¯**ã‚¯ãƒ©ã‚¹ã‚¿**ã‚’æ§‹æˆã—ã¾ã™ã€‚è¤‡æ•°ã®ãƒãƒ¼ãƒ‰ã‚’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã®é…ä¸‹ã¨ã™ã‚‹ã“ã¨ã§ã€ãƒãƒ¼ãƒ‰ã‚’è·¨ã„ã§ãƒãƒƒãƒ‰ã‚’èµ·å‹•ã•ã›ã‚‹ã“ã¨ã‚‚å¯èƒ½ã«ãªã‚Šã¾ã™ã€‚
minikubeã¯ç°¡å˜ã«ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã›ã¾ã™ã€‚

```{code-block} PS1
:caption: ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã—ã¦æ§˜å­ã‚’è¦‹ã‚‹

PS> minikube node add # ãƒãƒ¼ãƒ‰ã‚’1ã¤è¿½åŠ 
ğŸ˜„  m02 ãƒãƒ¼ãƒ‰ã‚’ minikube ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ã«è¿½åŠ ã—ã¾ã™
â—  ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãŒ CNI ãªã—ã§ä½œæˆã•ã‚ŒãŸãŸã‚ã€ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã¨ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãŒç ´æã™ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚
ğŸ‘  minikube ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ä¸­ã® minikube-m02 ãƒ¯ãƒ¼ã‚«ãƒ¼ãƒãƒ¼ãƒ‰ã‚’èµ·å‹•ã—ã¦ã„ã¾ã™
ğŸ”¥  hyperkit VM (CPUs=2, Memory=2200MB, Disk=20000MB) ã‚’ä½œæˆã—ã¦ã„ã¾ã™...
ğŸ³  Docker 20.10.17 ã§ Kubernetes v1.24.3 ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...
ğŸ”  Kubernetes ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’æ¤œè¨¼ã—ã¦ã„ã¾ã™...
ğŸ„  minikube ã¸ã® m02 è¿½åŠ ã«æˆåŠŸã—ã¾ã—ãŸï¼
PS> kubectl get deploy # èµ·å‹•å¾Œæ§˜å­ã‚’è¦‹ã¦ã¿ã‚‹ã¨â€¦
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   5/8     8            5           5m46s
```

3ã¤å¢—ãˆã¾ã—ãŸã€4ã¤ã«ãªã‚‰ãªã„ã®ã¯ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒã‚¹ã‚¿ãƒ¼ã¨ã®é€šä¿¡ãƒ—ãƒ­ã‚»ã‚¹ãŒä¸€éƒ¨CPUã‚’æ¶ˆè²»ã—ã¦ã„ã‚‹ã‹ã‚‰ã ã¨æ€ã‚ã‚Œã¾ã™ã€‚
Podã®çŠ¶æ…‹ã«ã¤ã„ã¦ã¯ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’è¶³ã™ã“ã¨ã§ã€Œã©ã“ã§å‹•ã„ã¦ã„ã‚‹ã‹ã€ãŒè¦‹ãˆã¾ã™ã€‚

```{code-block} ps1
PS1> kubectl get pods -o wide
NAME                        READY   STATUS    RESTARTS   AGE     IP           NODE
frontend-675c86d757-6ztxg   1/1     Running   0          8m11s   172.17.0.4   minikube
frontend-675c86d757-fxwlf   1/1     Running   0          8m18s   172.17.0.3   minikube
frontend-675c86d757-gzh4c   1/1     Running   0          8m11s   172.17.0.4   minikube-m02
frontend-675c86d757-mt57f   1/1     Running   0          8m11s   172.17.0.3   minikube-m02
frontend-675c86d757-qfjn8   0/1     Pending   0          8m11s   <none>       <none>
frontend-675c86d757-t2x8g   0/1     Pending   0          8m11s   <none>       <none>
frontend-675c86d757-wlgq9   0/1     Pending   0          8m11s   <none>       <none>
frontend-675c86d757-xvgt6   1/1     Running   0          8m11s   172.17.0.2   minikube-m02
```

ã©ã†ã‚„ã‚‰ã“ã®ç’°å¢ƒã ã¨ã€1ã¤ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã™ã¨2CPUã§3ã¤å‹•ã‹ã›ã‚‹ã¿ãŸã„ãªã®ã§ã€ã‚‚ã†ã²ã¨ã¤è¶³ã—ãŸã‚‰å…¨éƒ¨å‹•ããã†ãªæ„Ÿã˜ã§ã™ã­ã€‚



```{code-block} ps1
PS> minikube node add # ãƒãƒ¼ãƒ‰ã‚’ã‚‚ã†1ã¤è¿½åŠ 
PS> kubectl get deploy
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   8/8     8            8           11m
PS> kubectl get pods -o wide
NAME                        READY   STATUS    RESTARTS   AGE   IP           NODE
frontend-675c86d757-6ztxg   1/1     Running   0          12m   172.17.0.4   minikube
frontend-675c86d757-fxwlf   1/1     Running   0          12m   172.17.0.3   minikube
frontend-675c86d757-gzh4c   1/1     Running   0          12m   172.17.0.4   minikube-m02
frontend-675c86d757-mt57f   1/1     Running   0          12m   172.17.0.3   minikube-m02
frontend-675c86d757-qfjn8   1/1     Running   0          12m   172.17.0.2   minikube-m03
frontend-675c86d757-t2x8g   1/1     Running   0          12m   172.17.0.4   minikube-m03
frontend-675c86d757-wlgq9   1/1     Running   0          12m   172.17.0.3   minikube-m03
frontend-675c86d757-xvgt6   1/1     Running   0          12m   172.17.0.2   minikube-m02
```

1. ç¾ãƒãƒƒãƒ‰æ§‹æˆã§ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¯¾å¿œã—ãã‚Œãªã„ã¨ããªã©ã«ã€ãƒãƒƒãƒ‰æ•°ã‚’å¢—ã‚„ã™(ã‚¹ã‚±ãƒ¼ãƒ«ã‚¢ã‚¦ãƒˆ)ã•ã›ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’åˆ†æ•£ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™
2. æœ¬å½“ã«æ··é›‘ã—ãŸçŠ¶æ…‹ã®å ´åˆã ã¨ã€ãƒãƒ¼ãƒ‰ã®æ€§èƒ½ä¸Šé™ã«ã¶ã¤ã‹ã£ã¦ã€å¢—ã‚„ã—ã¦ã‚‚å‹•ã„ã¦ãã‚Œãªã„ã“ã¨ãŒã‚ã‚Šã¾ã™
3. ãƒãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§èµ·å‹•ã§ãã¦ã„ãªã‹ã£ãŸãƒãƒƒãƒ‰ãŒå‹•ãã‚ˆã†ã«ãªã‚Šã€æ›´ã«åˆ†æ•£ãŒå®Ÿç¾ã—ã¾ã™


## ãƒãƒ¼ãƒ‰ã®å‰Šé™¤ã¨å¾Œç‰‡ä»˜ã‘

(ãƒ¯ãƒ¼ã‚«ãƒ¼)ãƒãƒ¼ãƒ‰ã¯ç¨¼åƒä¸­ã§ã‚ã£ã¦ã‚‚å‰Šé™¤ã§ãã¾ã™ã€‚
ã‚ã¶ã‚ŒãŸ(å·»ãæ·»ãˆã§æ¶ˆæ»…ã—ãŸ)ãƒãƒƒãƒ‰ã¯ã€æ®‹ã‚Šã®ãƒãƒ¼ãƒ‰å†…ã§å†èµ·å‹•ã‚’è©¦ã¿ã¾ã™ã€‚
ãŸã¨ãˆã°ãƒãƒ¼ãƒ‰2ç•ª(minikube-m02)ã‚’å‰Šé™¤ã—ã¦ã¿ã¾ã™ã€‚

```{code-block} ps1
PS> minikube node delete m02 # m03æ®‹ã—ã¦m02ã‚’å‰Šé™¤
PS> kubectl get deploy
NAME       READY   UP-TO-DATE   AVAILABLE   AGE
frontend   5/8     8            5           16m
```

ã“ã®ã‚ˆã†ã«ã€ãƒãƒ¼ãƒ‰æ•°ãŒæ¸›ã‚‹ã¨ã€ãã®åˆ†å‹•ã‘ã‚‹ãƒãƒƒãƒ‰ãŒä¸€æ™‚çš„ã«æ¸›ã£ã¦ã—ã¾ã„ã¾ã™ã€ãã®ãŸã‚æ®‹ã£ãŸãƒãƒ¼ãƒ‰ã§å¯èƒ½ãªã‚‰èµ·å‹•ã‚’è©¦ã¿ã¾ã™ã€‚
ã§ã‚‚æ®‹å¿µãªãŒã‚‰ä»Šå›ã¯å‹•ã‹ã›ã¾ã›ã‚“ã€‚

ãƒãƒ¼ãƒ‰ã¯å‹•çš„ã«å¢—æ¸›ã§ãã‚‹ã®ã§ã€ä¾‹ãˆã°â€¦

1. ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹æ™‚ã¯ç‰©çã—ã•ã§ã‚¢ã‚¯ã‚»ã‚¹ãŒå¢—ãˆã‚‹ â†’ ãƒãƒ¼ãƒ‰ã‚’å¢—ã‚„ã—ã¦ã„å¯¾å¿œ
2. ã‚ã‚‹ç¨‹åº¦åˆæœŸã«è©¦ã—ãŸäººãŒæŠœã‘ã¦æ€§èƒ½ãŒä½™ã£ã¦ãã¦ã‚‹ â†’ ãƒãƒ¼ãƒ‰ã‚’å‰Šã£ã¦å¿…è¦ãªç¯„å›²ã«ã™ã‚Œã°ã‚³ã‚¹ãƒˆãƒ€ã‚¦ãƒ³

ã¨ãªã‚Šã¾ã™ã€‚

ã•ã¦å¾Œå§‹æœ«ã¨ã—ã¦ã€ã‚‚ã¨ã‚‚ã¨ã®ã‚¯ãƒ©ã‚¹ã‚¿æ§‹æˆã«æˆ»ã—ã¾ã™ã€‚

```{code-block} ps1
PS> minikube delete
PS> minikube start # åˆæœŸå€¤ã§å†åº¦ç”Ÿæˆ
```

